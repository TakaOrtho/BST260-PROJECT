---
title: "Takahisa_260final"
author: "Takahisa Ogawa"
date: "12/5/2019"
output: html_document
---

```{r data extraction}
library(lubridate)
library(tidyverse)
library(readr)
source("data_source.R")
rm(datad,dataf,dataa,datas,datax,dataq)
```


```{r}
set.seed(2019)
clusters <- kmeans(data[,1:2], 5)
data$Borough <- as.factor(clusters$cluster)
str(clusters)
library(ggmap)
library(maps)
register_google(key ='AIzaSyBDLso8Zh-0N43d6reTGeiZffpmI50ssc4')
has_google_key()
map <- map_data("state")
map <- get_map("New York", zoom = 10)
ggmap(map) + geom_point(aes(x = Lon[], y = Lat[], colour = as.factor(Borough)),data = data) +
  ggtitle("")


ggmap(
  ggmap = get_map(
    "Dayton",
     zoom = 13, scale = "auto",
     maptype = "satellite",
     source = "google"),
  extent = "device",
  legend = "topright"
  )
```


```{r}
data2 <- data %>% mutate(month = month(EVENTDATE), year = year(EVENTDATE)) 
timeseries <- data2%>% group_by(year,month) %>%
  summarise(amputation =sum(AMPUTATION)) %>% inner_join(data2, by=c('year'='year','month'='month'))

timeseries <- data2 %>% group_by(year, month) %>%
  mutate(amputation =sum(AMPUTATION)) 

timeseries %>% ggplot()+aes(EVENTDATE,amputation) +geom_line()+
  xlab('Date')+ylab('Number of Amputaions (people)')

timeseries %>% ggplot()+aes(EVENTDATE,amputation) +geom_smooth()+
  xlab('Date')+ylab('Number of Amputaions (people)')

timeseries <- data %>% group_by(year, month) %>%
  mutate(amputation =sum(AMPUTATION)) 

```





```{r}

EucDistHp <- read_csv("EucDistHp.csv", col_types = cols(OBJECTID = col_skip()))
inj_join <- read_csv("D:/Dropbox/HARVARD MPH/BST/BST260/BST260-PROJECT7/inj_join.csv",col_types = cols(XCoord = col_skip(),  YCoord = col_skip()))

EucDistHp <- rename(EucDistHp,ZIP=ZCTA5CE10)
EucDistHp$ZIP <- as.numeric(as.character(EucDistHp$ZIP))
inj_join <- rename(inj_join,ZIP=ZIP_1)
inj_join$ZIP <- as.numeric(as.character(inj_join$ZIP))
data <- rename(data,ZIPpre=ZIP)

data<-data%>%left_join(inj_join,by='ID')
data<-data%>%left_join(EucDistHp ,by='ZIP')
```




```{r mapping}
library(leaflet)

map <- data %>% filter(NATURETITLE=='Fractures') 
leaflet() %>% 
  setView(-95, 40, zoom= 3.5) %>% 
  addCircles(data = map, lat= ~as.numeric(LATITUDE), lng = ~as.numeric(LONGITUDE),
             weight = 0.4, color="BLUE", stroke = TRUE, fillOpacity = 1) %>%
  addProviderTiles(providers$CartoDB.Positron, group = "Standard") %>%    addScaleBar()

```




